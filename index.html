<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KATI STUDIO - ƒêANG T·∫¢I...</title>
    <link rel="icon" href="logo.png" type="image/png">
    
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; overflow: hidden; background-color: #f0f2f5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        iframe { width: 100%; height: 100%; border: none; display: block; -webkit-overflow-scrolling: touch; }
        
        /* M√†n h√¨nh h∆∞·ªõng d·∫´n chung (·∫®n m·∫∑c ƒë·ªãnh) */
        .guide-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 99999; color: white; text-align: center;
        }

        /* Style ri√™ng cho iPhone */
        #ios-guide .guide-arrow {
            position: absolute; top: 10px; right: 20px; width: 60px; height: auto; animation: bounce 1s infinite;
        }
        
        /* Style cho Android (n·∫øu l·ª° ko t·ª± chuy·ªÉn ƒë∆∞·ª£c th√¨ hi·ªán n√∫t n√†y) */
        #android-manual {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        .guide-text { margin-top: 100px; padding: 20px; font-size: 1.1rem; line-height: 1.6; font-weight: 600; }
        .btn-manual {
            background: #356854; color: white; padding: 15px 30px; border-radius: 50px;
            text-decoration: none; font-weight: 700; margin-top: 20px; border: 1px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div id="ios-guide" class="guide-overlay">
        <svg class="guide-arrow" viewBox="0 0 24 24" fill="white">
            <path d="M12 2L12 22 M12 2L5 9 M12 2L19 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="guide-text">
            <p>‚ö†Ô∏è iPhone kh√¥ng h·ªó tr·ª£ m·ªü tr√™n Zalo.</p>
            <p>Vui l√≤ng nh·∫•n v√†o d·∫•u <b>(...)</b> ·ªü g√≥c tr√™n b√™n ph·∫£i</p>
            <p>üëâ Ch·ªçn <b>"M·ªü b·∫±ng tr√¨nh duy·ªát"</b> (Safari)</p>
        </div>
    </div>

    <div id="android-guide" class="guide-overlay" style="background: #f0f2f5; color: #333;">
        <div id="android-manual">
            <h3 style="color: #356854;">KATI STUDIO</h3>
            <p>ƒêang chuy·ªÉn sang tr√¨nh duy·ªát...</p>
            <div style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">N·∫øu kh√¥ng t·ª± chuy·ªÉn, vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi:</div>
            <a href="#" id="btn-android-link" class="btn-manual">M·ªû TR√åNH DUY·ªÜT NGAY üöÄ</a>
        </div>
    </div>

    <iframe 
        id="mainFrame" 
        title="Kati Studio App"
        sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation"
    ></iframe>

    <script>
        // LINK GOOGLE SCRIPT G·ªêC C·ª¶A B·∫†N
        const LINK_GOOGLE_GOC = "https://script.google.com/macros/s/AKfycbwx48cWA84d4e2Iw31ViBpZSo-cNC8YP2UTD0KpOhCV7_WLw2aFwjDdm2mbmm5IkWNb/exec"; 

        function init() {
            var ua = navigator.userAgent;
            var isZalo = ua.indexOf("Zalo") > -1;
            var isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
            var isAndroid = ua.indexOf("Android") > -1;
            
            // X·ª≠ l√Ω tham s·ªë URL
            var params = window.location.search; 
            if (!params.includes("page=")) {
                var prefix = params ? "&" : "?";
                params += prefix + "page=kyonline";
            }
            
            // Link ƒë√≠ch ƒë·∫øn Google Apps Script
            var targetGoogleLink = LINK_GOOGLE_GOC + params;
            
            // --- X·ª¨ L√ù ZALO ---
            if (isZalo) {
                // A. N·∫æU L√Ä ANDROID
                if (isAndroid) {
                    // Hi·ªÉn th·ªã m√†n h√¨nh ch·ªù (ƒë·ªÉ che c√°i iframe tr·∫Øng ƒëi)
                    document.getElementById("android-guide").style.display = "block";
                    
                    // L·∫•y ƒë∆∞·ªùng d·∫´n hi·ªán t·∫°i (Vercel) nh∆∞ng b·ªè 'https://'
                    var currentUrlNoProtocol = window.location.href.replace(/^https?:\/\//, "");
                    
                    // [QUAN TR·ªåNG] T·∫°o Intent kh√¥ng ch·ªâ ƒë·ªãnh 'package' -> M√°y s·∫Ω t·ª± ch·ªçn tr√¨nh duy·ªát m·∫∑c ƒë·ªãnh
                    // S.browser_fallback_url d√πng ƒë·ªÉ ph√≤ng h·ªù n·∫øu intent l·ªói
                    var intentUrl = "intent://" + currentUrlNoProtocol + "#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=" + encodeURIComponent(window.location.href) + ";end";
                    
                    // G√°n link cho n√∫t b·∫•m th·ªß c√¥ng (ph√≤ng h·ªù)
                    document.getElementById("btn-android-link").href = intentUrl;

                    // T·ª± ƒë·ªông k√≠ch ho·∫°t chuy·ªÉn h∆∞·ªõng
                    window.location.href = intentUrl;
                    return; 
                }
                
                // B. N·∫æU L√Ä IPHONE
                if (isIOS) {
                    document.getElementById("ios-guide").style.display = "block";
                    return;
                }
            }

            // --- KH√îNG PH·∫¢I ZALO (CH·∫†Y B√åNH TH∆Ø·ªúNG) ---
            document.getElementById("mainFrame").src = targetGoogleLink;
        }

        init();
    </script>
</body>
</html>
