<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KATI STUDIO - K√ù H·ª¢P ƒê·ªíNG ONLINE</title>
    <link rel="icon" href="logo.png" type="image/png">
    
    <style>
        html, body { 
        margin: 0; 
        padding: 0; 
        width: 100%; 
        height: 100%; 
        overflow: hidden; /* NgƒÉn trang g·ªëc cu·ªôn, ƒë·ªÉ iframe t·ª± cu·ªôn */
        background-color: #f0f2f5; 
        /* H·ªó tr·ª£ c√°c tr√¨nh duy·ªát r·∫•t c≈© */
        display: block;
    }

    /* M·∫πo c·ª±c quan tr·ªçng cho Safari iPhone */
    iframe { 
        border: none;
        display: block;
        width: 1px; 
        min-width: 100%; 
        height: 100%;
        /* Gi√∫p cu·ªôn m∆∞·ª£t tr√™n iPhone c≈© */
        -webkit-overflow-scrolling: touch; 
        overflow-y: auto;
        opacity: 0;
        transition: opacity 0.5s ease;
    }
    
    iframe.loaded { 
        opacity: 1; 
    }
        
        /* --- M√ÄN H√åNH LOADING LOGO --- */
        #initial-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #ffffff; /* N·ªÅn tr·∫Øng s·∫°ch */
            z-index: 5000; /* Cao h∆°n iframe, th·∫•p h∆°n h∆∞·ªõng d·∫´n Zalo */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        #initial-loader.hidden { opacity: 0; visibility: hidden; }
        
        .loader-logo {
            width: 100px; /* K√≠ch th∆∞·ªõc logo */
            height: auto;
            margin-bottom: 15px;
            animation: pulse 1.5s infinite ease-in-out; /* Hi·ªáu ·ª©ng nh·∫•p nh√°y */
        }
        
        .loader-text {
            color: #356854; /* M√†u xanh Kati */
            font-weight: 600; font-size: 0.9rem; letter-spacing: 1px;
            text-transform: uppercase;
            animation: fadeIn 2s;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- M√†n h√¨nh h∆∞·ªõng d·∫´n Zalo (Gi·ªØ nguy√™n) --- */
        .guide-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 99999; color: white; text-align: center;
        }
        #ios-guide .guide-arrow {
            position: absolute; top: 10px; right: 20px; width: 60px; height: auto; animation: bounce 1s infinite;
        }
        #android-manual { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
        .guide-text { margin-top: 100px; padding: 20px; font-size: 1.1rem; line-height: 1.6; font-weight: 600; }
        .btn-manual {
            background: #356854; color: white; padding: 15px 30px; border-radius: 50px;
            text-decoration: none; font-weight: 700; margin-top: 20px; border: 1px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div id="initial-loader">
        <img src="logo.png" alt="KATI STUDIO" class="loader-logo" onerror="this.style.display='none'; document.getElementById('text-fallback').style.display='block'">
        <div id="text-fallback" class="loader-text" style="display:none; font-size: 1.5rem; font-family: serif;">KATI STUDIO</div>
        <div class="loader-text" style="font-size: 0.75rem; margin-top: 5px;">ƒêang k·∫øt n·ªëi...</div>
    </div>

    <div id="ios-guide" class="guide-overlay">
        <svg class="guide-arrow" viewBox="0 0 24 24" fill="white">
            <path d="M12 2L12 22 M12 2L5 9 M12 2L19 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="guide-text">
            <p>‚ö†Ô∏è iPhone kh√¥ng h·ªó tr·ª£ m·ªü tr√™n Zalo.</p>
            <p>Vui l√≤ng nh·∫•n v√†o d·∫•u <b>[ ... ]</b> ·ªü g√≥c tr√™n b√™n ph·∫£i</p>
            <p>üëâ Ch·ªçn <b>"M·ªü b·∫±ng Safari"</b> (Ho·∫∑c tr√¨nh duy·ªát kh√°c)</p>
        </div>
    </div>

    <div id="android-guide" class="guide-overlay" style="background: #f0f2f5; color: #333;">
        <div id="android-manual">
            <h3 style="color: #356854;">KATI STUDIO</h3>
            <p>ƒêang chuy·ªÉn sang tr√¨nh duy·ªát...</p>
            <a href="#" id="btn-android-link" class="btn-manual">M·ªû TR√åNH DUY·ªÜT NGAY üöÄ</a>
        </div>
    </div>

    <iframe 
        id="mainFrame" 
        title="Kati Studio App"
        sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation allow-presentation"
    ></iframe>

    <script>
        // LINK GOOGLE SCRIPT G·ªêC C·ª¶A B·∫†N
        const LINK_GOOGLE_GOC = "https://script.google.com/macros/s/AKfycbwx48cWA84d4e2Iw31ViBpZSo-cNC8YP2UTD0KpOhCV7_WLw2aFwjDdm2mbmm5IkWNb/exec"; 

        // H√†m t·∫Øt loading
        function hideLoader() {
            var loader = document.getElementById('initial-loader');
            var iframe = document.getElementById('mainFrame');
            if(loader) loader.classList.add('hidden');
            if(iframe) iframe.classList.add('loaded');
        }

        function init() {
            var ua = navigator.userAgent;
            var isZalo = ua.indexOf("Zalo") > -1;
            var isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
            var isAndroid = ua.indexOf("Android") > -1;
            
            // Tham s·ªë URL
            var params = window.location.search; 
            if (!params.includes("page=")) {
                var prefix = params ? "&" : "?";
                params += prefix + "page=kyonline";
            }
            var targetGoogleLink = LINK_GOOGLE_GOC + params;

            // --- LOGIC HI·ªÇN TH·ªä LOADING ---
            // 1. G√°n link cho Iframe
            var iframe = document.getElementById("mainFrame");
            iframe.src = targetGoogleLink;

            // 2. Khi Iframe t·∫£i xong -> T·∫Øt Loading
            iframe.onload = function() {
                // Ch·ªù th√™m 500ms cho m∆∞·ª£t
                setTimeout(hideLoader, 500);
            };

            // 3. (D·ª± ph√≤ng) N·∫øu Iframe t·∫£i l√¢u qu√° 4s th√¨ c·ª© t·∫Øt loading ƒëi cho kh√°ch xem n·ªôi dung
            setTimeout(hideLoader, 4000);

            // --- X·ª¨ L√ù RI√äNG CHO ZALO ---
            if (isZalo) {
                // A. ANDROID: Chuy·ªÉn h∆∞·ªõng
                if (isAndroid) {
                    document.getElementById("android-guide").style.display = "block";
                    var currentUrlNoProtocol = window.location.href.replace(/^https?:\/\//, "");
                    var intentUrl = "intent://" + currentUrlNoProtocol + "#Intent;scheme=https;action=android.intent.action.VIEW;S.browser_fallback_url=" + encodeURIComponent(window.location.href) + ";end";
                    document.getElementById("btn-android-link").href = intentUrl;
                    window.location.href = intentUrl;
                    return; 
                }
                
                // B. IPHONE: Hi·ªán h∆∞·ªõng d·∫´n, ·∫®n loading ƒëi ƒë·ªÉ hi·ªán h∆∞·ªõng d·∫´n r√µ h∆°n
                if (isIOS) {
                    hideLoader(); // T·∫Øt loading logo ƒë·ªÉ hi·ªán h∆∞·ªõng d·∫´n ƒëen
                    document.getElementById("ios-guide").style.display = "block";
                    return;
                }
            }
        }

        init();
    </script>
</body>
</html>
